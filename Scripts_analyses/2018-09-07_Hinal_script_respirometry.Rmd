---
title: "respirometry_hinal"
output: 
  html_document: 
    toc: yes
editor_options: 
  chunk_output_type: console
---

# Load libraries

```{r}
library(ggplot2)
library(dplyr)
library(data.table)
library(lubridate)
```





# Load data

WE want to load the data and calculate quick and dirty mass specific metabolism (with not accounting for hours just yet; so no rate)

```{r hinal}

resp<-fread("../Data/2018-09-07_Hinal_diapause_determination.csv")
dim(resp)
head(resp)

#convert purge times to units in hours
resp$purge_time<-hour(hm(resp$`Purge time`))+minute(hm(resp$`Purge time`))/60
```


# calculating purge time

we need to create a sequence of purge times that are the length of the cohorts

```{r}
resp$cohort_date<-as.factor(resp$cohort_date)
test<-base::subset(resp,cohort_date=='9/3/2018' & tape=="red")
test<-base::subset(resp,cohort_date=="9/3/2018")




```


```{r}
#resp$msmr<- (resp$day8_resp / resp$day7_weight) 

resp$msmr<- (resp$Respiration/ resp$weight ) 

#if you have multiple cohorts, use this code
ggplot2::ggplot(resp,aes(x=msmr))+geom_histogram()+xlim(0,0.25)+facet_wrap(cohort_date~.)+geom_vline(xintercept=0.065)
#by host
ggplot2::ggplot(resp,aes(x=msmr))+geom_histogram()+xlim(0,0.25)+facet_wrap(cohort_date~Host)+geom_vline(xintercept=0.065)

#by host and cohort date + resp date
resp$co_resp<-paste(resp$cohort_date,resp$day_resp)
ggplot2::ggplot(resp,aes(x=msmr))+geom_histogram()+xlim(0,0.25)+facet_grid(co_resp~Host)+geom_vline(xintercept=0.065)

# it looks like 0.065 is a good cut off for all cohorts; lets parse out samples based on this value

resp$CLASS<-ifelse(resp$msmr<0.065,"Diapause","Non-diapause")

glimpse(resp)

fwrite(resp,"../Data/raw/Respirometry/2018/Hinal/2018-09-19_CLASSING_respirometry.csv")


resp%>%
  group_by(cohort_date,CLASS)%>%
  summarise(n=length(CLASS))

```


### Hinal wants 3 plots

### Apple day 8 ( y axis= count; x-axis = msmr)

```{r}
respA.8<-resp%>%
  subset(Host=="Apple"& day_resp == "8")

ggplot2::ggplot(respA.8,aes(x=msmr))+geom_histogram()+xlim(0,0.25)+facet_wrap(~cohort_date,scale="free")+geom_vline(xintercept=0.065)

```
### Apple day 20 

```{r}
respA.20<-resp%>%
  subset(Host=="Apple"& day_resp == "20")

ggplot2::ggplot(respA.20,aes(x=msmr))+geom_histogram()+xlim(0,0.25)+facet_wrap(~cohort_date,scale="free")+geom_vline(xintercept=0.065)
```
#Hwthorn day 8 

```{r}
respH.8<-resp%>%
  subset(Host=="Hawthorn"& day_resp == "8")

ggplot2::ggplot(respH.8,aes(x=msmr))+geom_histogram()+xlim(0,0.25)+facet_wrap(~cohort_date,scale="free")+geom_vline(xintercept=0.065)

```

# if you have 1 cohort, use this code
respco<-resp%>%
  filter(cohort_date=="9/3/2018")

# this will plot the histogram for you to determine the cutoff value for diapause or non-diapause
ggplot2::ggplot(respco,aes(x=msmr))+geom_histogram()#+geom_vline(xintercept=.06)

# this code tells you what cut off to determine diapause or non diapause animals

respco$dia_class<-ifelse(respco$msmr<0.06,"Diapause","Non-diapause")
#glimpse(respco11)

#determine numbers of diapause and non-diapause
respco%>%
  group_by(dia_class)%>%
  summarise(n=length(dia_class))

#fwrite(respco11,"2018-09-07_d11cohort_resp_at_day11.csv")



# Andrew's dataset

```{r, eval=FALSE, include=FALSE}
resp<-fread("../Data/2018-08-07_data_slice.csv")

resp$msmr<- (resp$resp_day11/ resp$mass_day10)/18.5
resp1<-resp%>%
  dplyr::filter(cohort_date=="2018-08-26" | cohort_date=="2018-08-27")

ggplot(resp1,aes(msmr))+geom_histogram()+facet_grid(cohort_date~.)#+geom_vline(xintercept=0.06)+xlim(0,0.3)

```

# Session info

```{r}
sessionInfo()
```